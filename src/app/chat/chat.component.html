<div class="card">
  <app-chat-header></app-chat-header>

  <div *ngIf="userData$ | async as authUser" class="message-wrapper" #scroll>
    <ng-container *ngFor="let message of messages$ | async; trackBy: trackByFn">
      <app-chat-message
        *ngIf="{
          connectedIsSender: message.userId === authUser.userId,
          user: message.userId | userById | async
        } as messageData"
        [message]="message"
        [connectedUserIsSender]="messageData.connectedIsSender"
        [userStatus]="messageData.user?.status"
        [userName]="
          messageData.connectedIsSender
            ? authUser.username
            : messageData.user?.name
        ">
      </app-chat-message>
    </ng-container>
  </div>

  <form [formGroup]="form" (submit)="sendMessage()">
    <div class="form-control">
      <input
        formControlName="message"
        type="text"
        placeholder="enter your text" />
      <div
        *ngIf="form.controls.message.touched && form.controls.message.errors?.['required']"
        class="error-message">
        Please enter a message.
      </div>
    </div>
    <button type="submit">Submit</button>
  </form>
</div>
